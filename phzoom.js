~function(h){var f=jQuery.fn.jquery,e=f.split("."),d=h(window),a=h(document);if(e[0]>=3||e[1]>=5){var b=h("<div id=ph_lay></div>"),j=h("<div id=ph_zoom></div>"),i=b.add(j);var c=function(l,k,n,m){this.opt=k;this.idx=n;this.all=m;this.len=m.length;this.end=this.len>n+1;this.img=h("img:first",l);this.lnk=l.addClass("phzoom").unbind("click").bind(this.imgFn()).append(this.hov=h("<span class=ph_hover></span>").hide())[0];this.cap=h("<div>",{css:{color:k.capColor},id:"ph_cap",html:h([h("<span>",{id:"ph_txt",text:this.img[0].title||this.lnk.title||"No title"})[0],h("<span>",{id:"ph_idx",text:n+1+" / "+this.len})[0]])}).add(this.nav=h("<div>",{id:"ph_nav",css:{color:k.navColor},html:(n?"<span id=ph_prev>"+k.prevText+"</span>":"")+(this.end?"<span id=ph_next>"+k.nextText+"</span>":"")}));i.click(h.proxy(this,"imgQuit"));window.XMLHttpRequest||l.height(this.img.height())}}else{var b=h("<div id=ph_lay/>"),j=h("<div id=ph_zoom/>"),i=b.add(j),c=function(l,k,n,m){this.opt=k;this.idx=n;this.all=m;this.len=m.length;this.end=this.len>n+1;this.img=h("img:first",l);this.lnk=l.addClass("phzoom").unbind("click").bind(this.imgFn()).append(this.hov=h("<span class=ph_hover/>").hide())[0];this.cap=h("<div/>",{css:{color:k.capColor},id:"ph_cap",html:h([h("<span/>",{id:"ph_txt",text:this.img[0].title||this.lnk.title||"No title"})[0],h("<span/>",{id:"ph_idx",text:n+1+" / "+this.len})[0]])}).add(this.nav=h("<div/>",{id:"ph_nav",css:{color:k.navColor},html:(n?"<span id=ph_prev>"+k.prevText+"</span>":"")+(this.end?"<span id=ph_next>"+k.nextText+"</span>":"")}));i.click(h.proxy(this,"imgQuit"));window.XMLHttpRequest||l.height(this.img.height())}}c.prototype={imgFn:function(){var l=this,k=function(){return l.hov.not(".loading").stop(0,1)};return{mouseover:function(){k().fadeIn()},mouseout:function(){k().fadeOut()},click:function(){l.imgLoad();return false}}},imgPos:function(m,o){var l=this.img,k=d.scrollLeft(),n=d.scrollTop(),p=[d.width(),d.height(),l.width(),l.height(),l.offset().left,l.offset().top];this.opt.limitWidth&&m>p[0]&&(o=o/m*(m=p[0]));return p.concat(m,o,(p[0]-m)/2+k,(p[1]-o)/2+n,(p[0]-p[2])/2+k,(p[1]-p[3])/2+n)},imgLoad:function(){b.fadeTo(this.opt.layDur,this.opt.layOpacity);var k=this,l=new Image;this.hov.addClass("loading");l.className="zoomed";l.onload=function(){l.onload=null;k.hov.hasClass("loading")&&(j.height(a.height()).append(l).show(),k.imgAnim(l),k.preLoad())};l.src=this.lnk.href},imgAnim:function(p){var m=this,l=h(p),o=this.imgPos(p.width||+l.attr("width"),p.height||+l.attr("height")),k=o[0]<o[6],n=this.evtMon(l,o[0],o[0]-o[6],!k);l.after(this.cap.hide()).css({left:o[4],top:o[5],width:o[2],height:o[3]}).animate({left:o[10],top:o[11]},this.opt.animDurA,function(){l.animate({left:o[8],top:o[9],width:o[6],height:o[7]},m.opt.animDurB,function(){m.hov.removeClass("loading");m.cap.css({top:o[7]+o[9],left:k?0:o[8],width:k?o[0]:o[6]}).fadeTo(300,0.7);m.nav.bind(n).css("top",o[7]/3+o[9]);m.keyBind()}).bind(n)})},imgQuit:function(k){this.hov.hide().hasClass("loading")?this.hov.removeClass("loading"):a.unbind(".phzoom");k&&b.fadeOut();j.hide().empty();return false},imgChange:function(k){this.imgQuit();h(".ph_hover",h(this.all[this.idx+k]).click()).show();return false},preLoad:function(k,l){this.idx&&(k=new Image,k.src=this.all[this.idx-1].href,delete k);this.end&&(l=new Image,l.src=this.all[this.idx+1].href,delete l)},keyBind:function(){var k=this;a.bind("keydown.phzoom",function(l){l=l.which;return l==37&&k.idx?k.imgChange(-1):l==39&&k.end?k.imgChange(1):l^27||k.imgQuit(1)})},evtMon:function(m,l,k,p){var n=this,o=h("span",this.nav).hide();return{click:function(q){return n.len<2||(q=q.pageX>l/2,n.idx?n.end?n.imgChange(q||-1):q||n.imgChange(-1):!q||n.imgChange(1))},mouseout:function(){o.hide()},mousemove:function(r,q){r=r.pageX,q=r>l/2;n.idx?(o.eq(q).show(),o.eq(1-q).hide()):o[q?"show":"hide"]();p||(r=r<l/3?0:r>l*2/3?k:k/2)==m.position().left||m.not(":animated").animate({left:r},200)}}}};h.phzoom=function(l,k,m){k=h.extend({layOpacity:0.7,layDur:300,animDurA:300,animDurB:300,navColor:"#cf0",capColor:"#cf0",prevText:"Prev",nextText:"Next",limitWidth:false,returnOrigin:true},k),(m=l.has("img"))[0]&&(h("#ph_lay")[0]||h("body").append(i),m.each(function(o,n){h.data(n,"phzoom",new c(h(n),k,o,m))}));return k.returnOrigin?l:m};h.fn.phzoom=function(k){return h.phzoom(this,k)};function g(k){console.log({}.toString.call(k)+" | "+k)}}(jQuery);